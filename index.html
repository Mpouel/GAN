<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAN Cube Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>GAN Cube Viewer</h1>
    <iframe src="gan/" frameborder="0" class="cube-view" id="cube-view" allow="bluetooth"></iframe>
    <div>
        <button id="getmoves" onclick="gm()">Get Moves</button>
    </div>
    <h3>Solution:</h3>
    <pre id="solution">Moves will appear here.</pre>
    <p id="update"></p>

    <!-- Load rubikjs library -->
    <script src="https://cdn.jsdelivr.net/npm/rubikjs@latest/dist/rubik.min.js"></script>
    <script>
        // Array to store moves
        let moves = [];

        // Listen for messages from the iframe
        window.addEventListener('message', function(event) {
            if (event.data.type === "MOVE") {
                moves.push(event.data.move);
                console.log("Move detected:", event.data.move);
            } else if (event.data === "Reset state") {
                moves = [];
                console.log("Reset state");
                document.getElementById("solution").textContent = "Moves will appear here.";
            }
        });

        // Function to get and display the solution
        function gm() {
            try {
                if (typeof Rubik === 'undefined') {
                    throw new Error("Rubik library not loaded!");
                }
                const cube = new Rubik();
                moves.forEach(move => {
                    if (cube[move]) {
                        cube[move]();
                    } else {
                        console.warn("Unknown move:", move);
                    }
                });
                const solution = cube.solve();
                document.getElementById("solution").textContent = solution;
                navigator.clipboard.writeText(solution)
                    .then(() => console.log("Solution copied to clipboard!"))
                    .catch(err => console.warn("Copy failed:", err));
                console.log("Solution:", solution);
            } catch (err) {
                console.error("Error:", err);
                alert("Error: " + err.message);
            }
        }

        // Optional: Auto-refresh logic (simplified)
        let lastFileContent = '';
        function checkForUpdates() {
            fetch('solve.js')
                .then(r => r.text())
                .then(data => {
                    if (data !== lastFileContent && data.search('Repl') === -1) {
                        lastFileContent = data;
                        if (navigator.onLine) {
                            document.getElementById('update').textContent =
                                'Update detected! Refreshing in 2 seconds...';
                            setTimeout(() => location.reload(), 2000);
                        }
                    }
                })
                .catch(console.error);
        }
        // Uncomment to enable auto-refresh
        // setInterval(checkForUpdates, 30000);
    </script>
</body>
</html>
