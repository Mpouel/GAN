<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GAN Cube viewer</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>
  <iframe src="gan/" frameborder="0" class="cube-view" id="cube-view" allow="bluetooth"></iframe>
  <button id="getMoves" onclick="gm()">Get moves</button>
  <div id="update"></div>
  <script src="https://cdn.jsdelivr.net/npm/cubejs/lib/cube.min.js"></script>
  <script>
    let moves = [];

    function solveScramble(scrambleMoves) {
      const scramble = scrambleMoves.join(" ");
      return cubejs.solve(scramble); // API navigateur
    }

    function gm() {
      try {
        const solution = solveScramble(moves);
        navigator.clipboard.writeText(solution);
        console.log("Got moves:\n" + solution);
      } catch (err) {
        console.error(err);
      }
    }

    document.getElementById('cube-view').onload = function () {
      const iframeWindow = document.getElementById('cube-view').contentWindow;

      // Fake prompt pour la MAC address
      const mac = 'AB:12:34:60:7E:DA';
      iframeWindow.prompt = function (...args) {
        console.log("Prompt intercepté:", args);
        return mac;
      };

      if (iframeWindow) {
        const logs = [];
        iframeWindow.console.log = function (...args) {
          logs.push(args);
          if (args[1] !== undefined) {
            if (args[1].type === "MOVE") {
              const move = args[1].move;
              console.log("Move détecté:", move);
              moves.push(move);
            }
          } else if (args == "Reset state") {
            moves.length = 0;
            console.log("Reset state");
          }
        };
        window.getIframeLogs = () => logs;
      }
    };
  </script>
</body>
</html>
