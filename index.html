<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAN Cube Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <iframe src="gan/" frameborder="0" class="cube-view" id="cube-view" allow="bluetooth"></iframe>
    <button id="getmoves" onclick="gm()">Get Moves</button>
    <pre id="solution"></pre>
    <p id="update"></p>
    <script src="https://cdn.jsdelivr.net/npm/rubikjs@latest/dist/rubik.min.js"></script>
    <script>
        let moves = [];

        // Listen for messages from the iframe
        window.addEventListener('message', function(event) {
            if (event.data.type === "MOVE") {
                moves.push(event.data.move);
                console.log("Move detected:", event.data.move);
            } else if (event.data === "Reset state") {
                moves.length = 0;
                console.log("Reset state");
            }
        });

        function gm() {
            try {
                if (typeof Rubik === 'undefined') {
                    throw new Error("Rubik library not loaded!");
                }
                const cube = new Rubik();
                moves.forEach(move => cube[move]());
                const solution = cube.solve();
                document.getElementById("solution").textContent = solution;
                navigator.clipboard.writeText(solution)
                    .catch(err => alert("Copy failed. Solution: " + solution));
                console.log("Solution:", solution);
            } catch (err) {
                console.error("Error:", err);
                alert("Error: " + err.message);
            }
        }

        // Auto-refresh logic (simplified)
        let lastFileContent = '';
        function checkForUpdates() {
            fetch('solve.js')
                .then(r => r.text())
                .then(data => {
                    if (data !== lastFileContent && data.search('Repl') === -1) {
                        lastFileContent = data;
                        if (navigator.onLine) {
                            document.getElementById('update').textContent =
                                'Update detected! Refreshing...';
                            setTimeout(() => location.reload(), 2000);
                        }
                    }
                })
                .catch(console.error);
        }
        setInterval(checkForUpdates, 30000); // Check every 30 seconds
    </script>
</body>
</html>
