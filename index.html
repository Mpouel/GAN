<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAN Cube viewer</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <iframe src="gan/" frameborder="0" class="cube-view" id="cube-view" allow="bluetooth"></iframe>
    <button id="getmoves" onclick="gm()">Get moves</button>
    <pre id="solution"></pre>
    <script type="module">import { Cube } from 'https://cdn.jsdelivr.net/npm/cubejs@latest/dist/cube.min.js';

        function gm() {
            try {
                if (typeof Cube === 'undefined') {
                    throw new Error("Cube library not loaded!");
                }
                const cub = new Cube();
                moves.forEach(move => cub.move(move));
                const solution = cub.solve();
                document.getElementById("solution").textContent = solution;
                navigator.clipboard.writeText(solution)
                    .catch(err => alert("Copy failed. Solution: " + solution));
                console.log("Solution:", solution);
            } catch (err) {
                console.error("Error:", err);
                alert("Error: " + err.message);
            }
        }

        // Handle iframe logs (if you must)
        document.getElementById('cube-view').onload = function() {
            const iframeWindow = this.contentWindow;
            iframeWindow.console.log = function(...args) {
                if (args[1]?.type === "MOVE") {
                    moves.push(args[1].move);
                    console.log("Move detected:", args[1].move);
                } else if (args[0] === "Reset state") {
                    moves.length = 0;
                    console.log("Reset state");
                }
            };
        };

        // Auto-refresh logic (simplified)
        let lastFileContent = '';
        function checkForUpdates() {
            fetch('solve.js')
                .then(r => r.text())
                .then(data => {
                    if (data !== lastFileContent && data.search('Repl') === -1) {
                        lastFileContent = data;
                        if (navigator.onLine) {
                            document.getElementById('update').textContent =
                                'Update detected! Refreshing...';
                            setTimeout(() => location.reload(), 2000);
                        }
                    }
                })
                .catch(console.error);
        }
        setInterval(checkForUpdates, 30000); // Check every 30 seconds
    </script>
</body>

</html>