<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GAN Cube viewer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <iframe src="gan/" frameborder="0" class="cube-view" id="cube-view" allow="bluetooth"></iframe>
  <button onclick="gm()">Get moves</button>
  <pre id="solution"></pre>

  <!-- ✅ sans type="module" -->
  <script src="https://cdn.jsdelivr.net/npm/cubejs/lib/cube.min.js"></script>

  <script>
    let moves = [];

    function solveScramble(scrambleMoves) {
      const scramble = scrambleMoves.join(" ");
      return cubejs.solve(scramble);
    }

    function gm() {
      try {
        const solution = solveScramble(moves);
        navigator.clipboard.writeText(solution);
        document.getElementById("solution").textContent = solution;
        console.log("Got moves:\n" + solution);
      } catch (err) {
        console.error(err);
      }
    }

    document.getElementById('cube-view').onload = function () {
      const iframeWindow = document.getElementById('cube-view').contentWindow;
      const mac = 'AB:12:34:60:7E:DA';
      iframeWindow.prompt = () => mac;

      if (iframeWindow) {
        const logs = [];
        iframeWindow.console.log = function (...args) {
          logs.push(args);
          if (args[1] && args[1].type === "MOVE") {
            const move = args[1].move;
            console.log("Move détecté:", move);
            moves.push(move);
          } else if (args == "Reset state") {
            moves.length = 0;
            console.log("Reset state");
          }
        };
        window.getIframeLogs = () => logs;
      }
    };
  </script>
</body>
</html>
